WCR_headgear = {
    usage = game
    selection_behavior = weighted_random

    ## WCR - Vanilla Overrides ##
    
    # Ethnic hats to preserve poor pop westernization rule behaviors
    # Most or all of these should just be clones of vanilla definitions
    WCR_chinese_common_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = chinese_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                chinese_manchu_queue_hairstyle_pops_trigger = yes
                poor_clothes_pop_trigger = yes
            }
        }
    }
    
    WCR_japanese_common_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = Japanese_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                japanese_clothes_pop_trigger = yes
                scope:pop ?= {
                    OR = {
                        is_pop_type = farmers
                        is_pop_type = peasants
                        is_pop_type = laborers
                        AND = {
                            is_pop_type = machinists
                            WCR_has_completed_westernization_trigger = no
                        }
                    }
                }   
            }
        }
    }
    
    WCR_native_american_bandanna = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = native_american_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }

        weight = {
            base = 0
            modifier = {
                add = 100
                native_american_clothes_pop_trigger = yes   
            }
        }
    }
    
    # Armed Forces Traditionalists wear this
    WCR_japanese_agitator_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = japanese_headgear_agitators
                range = { 0 1 }
            }
            accessory = { # It's accompanied by the older hairstyle in vanilla
                mode = replace
                gene = hairstyles
                template = japanese_hairstyles
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 3000
                japanese_clothes_trigger = yes
                politician_clothes_trigger = yes
                armed_forces_clothes_trigger = yes
                scope:character ?= {
                    owner ?= {
                        has_variable = meiji_restoration_complete
                        WCR_st_is_country_westernized = yes
                    }
                    has_ideology = ideology:ideology_traditionalist
                }
            }
        }
    }
    
    ## WCR - Additions ##
    
    WCR_european_agitator_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_headgear_agitators
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2000
                WCR_has_completed_westernization_trigger = yes
                agitator_character_trigger = yes
            }
        }
    }
    
    WCR_european_royal_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_royal_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2000
                WCR_has_completed_westernization_trigger = yes
                monarchy_clothes_trigger = yes
            }
            modifier = { # Try to guarantee queen's crown
                add = 100
                WCR_has_completed_westernization_trigger = yes
                monarchy_clothes_trigger = yes
                scope:character ?= {
                    is_female = yes
                }
            }
        }
    }
    
    WCR_european_common_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2000
                WCR_has_completed_westernization_trigger = yes
                politician_clothes_trigger = yes
                armed_forces_clothes_trigger = no
                monarchy_clothes_trigger = no
                scope:character ?= {
                    age > 12
                }
            }
        }
    }
    
    WCR_european_capitalist_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_tophat
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2000
                WCR_has_completed_westernization_trigger = yes
                upper_clothes_pop_trigger = yes
            }
        }
    }
    
    WCR_european_bowler_hat = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_bowlerhat
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2000
                WCR_has_completed_westernization_trigger = yes
                middle_clothes_pop_trigger = yes
            }
        }
    }
    
    WCR_european_flat_cap = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_flatcap
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100 # 2000 # Leave at 100 so laborers have flatcaps or their culturally-relevant hats
                WCR_has_completed_westernization_trigger = yes
                poor_clothes_pop_trigger = yes
                peasants_clothes_pop_trigger = no
            }
            modifier = {
                add = 1900
                WCR_has_completed_westernization_trigger = yes
                OR = { # But always give westernized machinists the flat cap
                    machinists_clothes_pop_trigger = yes
                    AND = { # and guarantee flat cap if fully westernize poor pops game rule is set
                        poor_clothes_pop_trigger = yes
                        peasants_clothes_pop_trigger = no
                        has_game_rule = WCR_westernize_poor_pop_clothing_yes
                    }
                }
            }
        }
    }
    
    WCR_european_peasants_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_strawhat
                range = { 0 1 } # For the randomness to work correctly
           
            } 
        }
        weight = {
            base = 0
            modifier = {
                add = 100 # 2000 # Leave at 100 for same reason as flat cap
                WCR_has_completed_westernization_trigger = yes
                peasants_clothes_pop_trigger = yes
            }
            modifier = {
                add = 1900 # Guarantee straw hat if fully westernize poor pops game rule is set
                WCR_has_completed_westernization_trigger = yes
                peasants_clothes_pop_trigger = yes
                has_game_rule = WCR_westernize_poor_pop_clothing_yes
            }
        }
    }
    
    WCR_european_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = german_military_headgear # peaked caps only # european_military_headgear
                range = { 0 0.5 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_no_influence_trigger = yes
            }
            modifier = { # Monarchy commanders in chief
                add = 2100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_no_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_european_admiral_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_admiral_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_navy_clothes_trigger = yes
                # WCR_navy_has_no_influence_trigger = yes # Hat is same for all flavors
            }
            modifier = { # Republic commanders in chief
                add = 2100
                republic_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                # WCR_ruler_has_no_influence_trigger = yes # Hat is same for all flavors
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_american_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = american_military_headgear
                range = { 0 0.6 } # 0.6 is upper limit for not having cowboy hats
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_american_influence_trigger = yes
            }
            modifier = {
                add = 2100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_american_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_british_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = british_military_headgear
                range = { 0 0.5 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_british_influence_trigger = yes
            }
            modifier = {
                add = 2100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_british_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_french_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = french_military_headgear
                range = { 0 0.5 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_french_influence_trigger = yes
            }
            modifier = {
                add = 2100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_french_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_german_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = german_military_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_german_influence_trigger = yes
            }
            modifier = {
                add = 2100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_german_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_russian_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = russian_military_headgear
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_russian_influence_trigger = yes
            }
            modifier = {
                add = 2100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_russian_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_korean_empire_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = korean_empire_military_headgear
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100 # Vanilla: 1200
                OR = {
                    AND = {
                        OR = {
                            has_game_rule = WCR_modded_KOR_westernization
                            has_game_rule = WCR_mixed_KOR_westernization
                        }
                        OR = {
                            scope:pop ?= {
                                exists = owner
                                c:KOR ?= owner
                            }
                            scope:character ?= {
                                exists = owner
                                c:KOR ?= owner
                            }
                        }
                        agitator_character_trigger = no
                        WCR_has_completed_westernization_trigger = yes
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_KOR_westernization
                        scope:character ?= {
                            # culture = cu:korean
                            owner ?= {
                                c:KOR ?= this
                                has_variable = KOR_korean_empire_declared
                            }
                        }
                        OR = {
                            scope:character = {
                                has_role = general
                            }
                            AND = {
                                politician_clothes_trigger = yes
                                armed_forces_clothes_trigger = yes
                                # scope:character ?= {
                                    # NOT = { has_ideology = ideology:ideology_traditionalist }
                                # }
                            }
                        }
                        agitator_character_trigger = no
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_KOR_westernization
                        scope:pop ?= {
                            # culture = cu:korean
                            owner ?= {
                                c:KOR ?= this
                                has_variable = KOR_korean_empire_declared
                            }
                        }
                        OR = {
                            soldier_clothes_pop_trigger = yes
                            officers_clothes_pop_trigger = yes
                        }
                    }
                }
            }
        }
    }
    
    WCR_japanese_meiji_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_military_02_colors
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2100 # Vanilla: 1200
                OR = {
                    AND = {
                        OR = {
                            has_game_rule = WCR_modded_JAP_westernization
                            has_game_rule = WCR_mixed_JAP_westernization
                        }
                        OR = {
                            scope:pop ?= {
                                exists = owner
                                c:JAP ?= owner
                            }
                            scope:character ?= {
                                exists = owner
                                c:JAP ?= owner
                            }
                        }
                        agitator_character_trigger = no
                        WCR_has_completed_westernization_trigger = yes
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_JAP_westernization
                        scope:character ?= {
                            # culture = cu:japanese
                            owner = {
                                c:JAP ?= this
                                has_variable = meiji_restoration_complete
                            }
                        }
                        OR = {
                            scope:character = {
                                has_role = general
                            }
                            AND = {
                                politician_clothes_trigger = yes
                                armed_forces_clothes_trigger = yes
                                # scope:character ?= {
                                    # NOT = { has_ideology = ideology:ideology_traditionalist }
                                # }
                            }
                        }
                        agitator_character_trigger = no
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_JAP_westernization
                        scope:pop ?= {
                            # culture = cu:japanese
                            owner = {
                                c:JAP ?= this
                                has_variable = meiji_restoration_complete
                            }
                        }
                        OR = {
                            soldier_clothes_pop_trigger = yes
                            officers_clothes_pop_trigger = yes
                        }
                    }
                }
            }
        }
    }
    
    WCR_arabic_military_fez = { # Excludes the fancy female headgear meant for high class pops
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_headgear
                template = arabic_fez_westernized
                accessory = male_headgear_arabic_common_01
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 2100 # Vanilla: 200
                WCR_has_completed_westernization_trigger = yes
                OR = {
                    scope:character ?= {
                        exists = owner
                        c:TUR ?= owner
                    }
                    scope:pop ?= {
                        exists = owner
                        c:TUR ?= owner
                    }
                }
                OR = {
                    AND = {
                        OR = {
                            monarchy_clothes_trigger = yes
                            AND = {
                                ruler_clothes_trigger    = yes
                                military_clothes_trigger = yes
                            }
                        }
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_chinese_modern_ruler_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template  = qing_new_army_headgear
                accessory = qing_guanmao
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 2100
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_domestic_influence_trigger = yes
                monarchy_clothes_trigger = yes
                scope:character ?= {
                    exists = owner
                    c:CHI ?= owner
                    is_female = no
                }
            }
        }
    }
    
    WCR_chinese_modern_commander_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template = qing_new_army_headgear
                range = { 0.5 1 }
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 2100
                WCR_has_completed_westernization_trigger = yes
                scope:character ?= {
                    exists = owner
                    c:CHI ?= owner
                }
                OR = {
                    AND = {
                        ruler_clothes_trigger    = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_chinese_modern_officer_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template  = qing_new_army_headgear
                accessory = xinjunmao_junguan
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 2100
                WCR_has_completed_westernization_trigger = yes
                scope:pop ?= {
                    exists = owner
                    c:CHI ?= owner
                }
                soldier_clothes_pop_trigger = no
                OR = {
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_chinese_modern_soldier_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template  = qing_new_army_headgear
                accessory = xinjunmao_shibing
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 2100
                WCR_has_completed_westernization_trigger = yes
                scope:pop ?= {
                    exists = owner
                    c:CHI ?= owner
                }
                soldier_clothes_pop_trigger = yes
                OR = {
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
}
