WCR_headgear = {
    usage = game
    selection_behavior = weighted_random

    ## WCR - Vanilla Overrides ##
    
    # Ethnic hats to preserve poor pop westernization rule behaviors
    # Most or all of these should just be clones of vanilla definitions
    WCR_chinese_common_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = chinese_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                chinese_manchu_queue_hairstyle_pops_trigger = yes
                poor_clothes_pop_trigger = yes
            }
            modifier = {
                add = -1000
                WCR_has_completed_westernization_trigger = yes
                has_game_rule = WCR_westernize_poor_pop_clothing_yes
            }
        }
    }
    
    WCR_japanese_common_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = Japanese_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                japanese_clothes_pop_trigger = yes
                scope:pop ?= {
                    OR = {
                        is_pop_type = farmers
                        is_pop_type = peasants
                        is_pop_type = laborers
                        AND = {
                            is_pop_type = machinists
                            WCR_has_completed_westernization_trigger = no
                        }
                    }
                }
            }
            modifier = {
                add = -1000
                WCR_has_completed_westernization_trigger = yes
                has_game_rule = WCR_westernize_poor_pop_clothing_yes
            }
        }
    }
    
    WCR_native_american_bandanna = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = native_american_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }

        weight = {
            base = 0
            modifier = {
                add = 100
                native_american_clothes_pop_trigger = yes   
            }
            modifier = {
                add = -1000
                WCR_has_completed_westernization_trigger = yes
                has_game_rule = WCR_westernize_poor_pop_clothing_yes
            }
        }
    }
    
    # Armed Forces Traditionalists wear this
    WCR_japanese_agitator_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = japanese_headgear_agitators
                range = { 0 1 }
            }
            accessory = { # It's accompanied by the older hairstyle in vanilla
                mode = replace
                gene = hairstyles
                template = japanese_hairstyles
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 2000
                japanese_clothes_trigger = yes
                politician_clothes_trigger = yes
                armed_forces_clothes_trigger = yes
                md_japanese_uniform_pack_active_trigger = no # JUP compatibility/deconflict
                scope:character ?= {
                    owner ?= {
                        has_variable = meiji_restoration_complete
                        WCR_st_is_country_westernized = yes
                    }
                    has_ideology = ideology:ideology_traditionalist
                }
            }
        }
    }
    
    ## WCR - Additions ##
    
    WCR_european_agitator_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_headgear_agitators
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                agitator_character_trigger = yes
            }
        }
    }
    
    WCR_european_royal_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_royal_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = { # Try to guarantee queen's crown
                add = 100
                WCR_has_completed_westernization_trigger = yes
                monarchy_clothes_trigger = yes
                scope:character ?= {
                    is_female = yes
                }
            }
        }
    }
    
    WCR_european_common_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_common_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                politician_clothes_trigger = yes
                armed_forces_clothes_trigger = no
                military_clothes_trigger = no
                scope:character ?= {
                    age > 12
                }
            }
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                ruler_clothes_trigger = yes
                republic_clothes_trigger = yes
                military_clothes_trigger = no
            }
            modifier = { # Don't have female characters wear the bonnet
                add = -1000
                scope:character ?= {
                    is_female = yes
                }
            }
        }
    }
    
    WCR_european_capitalist_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_tophat
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                upper_clothes_pop_trigger = yes
            }
            modifier = {
                add = 1000
                WCR_has_completed_westernization_trigger = yes
                scope:character ?= {
                    age >= define:NCharacters|ADULT_AGE
                    politician_clothes_trigger = yes
                    military_clothes_trigger   = no
                    OR = {
                        is_interest_group_type = ig_landowners
                        is_interest_group_type = ig_industrialists
                    }
                }
            }
        }
    }
    
    WCR_european_executive_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_executive_hats
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 10000
                WCR_has_completed_westernization_trigger = yes
                OR = {
                    executive_clothes_trigger = yes
                    # AND = { # As of 1.9.2, this is just 50% top hat & 50% no hat, so exclude politicians for now
                        # politician_clothes_trigger = yes
                        # scope:character ?= {
                            # is_interest_group_type = ig_industrialists
                        # }
                    # }
                }
            }
        }
    }
    
    WCR_european_bowler_hat = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_bowlerhat
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                middle_clothes_pop_trigger = yes
            }
        }
    }
    
    WCR_european_flat_cap = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_flatcap
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100 # Leave at 100 so laborers have flatcaps or their culturally-relevant hats
                WCR_has_completed_westernization_trigger = yes
                poor_clothes_pop_trigger = yes
                peasants_clothes_pop_trigger = no
            }
        }
    }
    
    WCR_european_peasants_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_strawhat
                range = { 0 1 } # For the randomness to work correctly
           
            } 
        }
        weight = {
            base = 0
            modifier = {
                add = 100 # Leave at 100 for same reason as flat cap
                WCR_has_completed_westernization_trigger = yes
                peasants_clothes_pop_trigger = yes
            }
        }
    }
    
    WCR_academic_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = academic_cap
                range = { 0 1 } # For the randomness to work correctly
            } 
        }
        weight = {
            base = 0
            modifier = {
                add = 1000
                academics_clothes_pop_trigger = yes
                WCR_has_completed_westernization_trigger = yes
            }
        }
    }
    
    WCR_european_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = german_military_headgear # peaked caps only # european_military_headgear
                range = { 0 0.5 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_no_influence_trigger = yes
                WCR_late_army_uniform_trigger = no
            }
            modifier = { # Monarchy commanders in chief
                add = 100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_no_influence_trigger = yes
                military_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
            }
            modifier = { # Exclude countries being handled by vanilla logic
                add = -5000
                OR = {
                    scope:character ?= {
                        owner ?= {
                            WCR_is_using_vanilla_rules = yes
                        }
                    }
                    scope:pop ?= {
                        owner ?= {
                            WCR_is_using_vanilla_rules = yes
                        }
                    }
                }
            }
        }
    }
    
    WCR_european_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = european_late_military_headgear
                accessory = male_headgear_european_military_cap_01
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_no_influence_trigger = yes
                WCR_late_army_uniform_trigger = yes
            }
            modifier = { # Monarchy commanders in chief
                add = 100
                monarchy_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_no_influence_trigger = yes
                military_clothes_trigger = yes
                WCR_late_army_uniform_trigger = yes
            }
            modifier = { # Exclude countries being handled by vanilla logic
                add = -5000
                OR = {
                    scope:character ?= {
                        owner ?= {
                            WCR_is_using_vanilla_rules = yes
                        }
                    }
                    scope:pop ?= {
                        owner ?= {
                            WCR_is_using_vanilla_rules = yes
                        }
                    }
                }
            }
        }
    }
    
    WCR_european_admiral_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_admiral_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_navy_clothes_trigger = yes
                # WCR_navy_has_no_influence_trigger = yes # Hat is same for all flavors
            }
            modifier = { # Republic commanders in chief
                add = 100
                republic_clothes_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                # WCR_ruler_has_no_influence_trigger = yes # Hat is same for all flavors
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_american_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = american_military_headgear
                range = { 0 0.6 } # 0.6 is upper limit for not having cowboy hats
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_american_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_american_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_american_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = american_military_headgear
                accessory = male_headgear_european_military_late_06 # Cowboy hats!!
            }
            accessory = { # Need better hair that fits with the hat
                mode = replace
                gene = hairstyles
                template = american_military_hairstyles
                range = { 0.70 1 }
            }
            morph = { # Stops heads from being too fat for the hat
                mode = modify
                gene = gene_head_top_width
                value = -0.25
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_american_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_american_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_british_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = british_military_headgear
                range = { 0 0.5 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                military_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_british_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_british_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_british_military_soldier_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = gb_01
                accessory = male_headgear_european_gb_01
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_british_influence_trigger = yes
                scope:pop ?= {
                    owner ?= {
                        NOT = { has_technology_researched = repeaters }
                    }
                }
            }
        }
    }
    
    WCR_british_military_soldier_mid_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = european_military_headgear
                accessory = male_headgear_european_military_09
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_british_influence_trigger = yes
                scope:pop ?= {
                    owner ?= {
                        has_technology_researched = repeaters
                    }
                }
            }
        }
    }
    
    WCR_british_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = late_military_cap
                accessory = male_headgear_european_late_military_04
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_british_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_british_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_french_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = french_military_headgear
                range = { 0 0.5 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_french_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_french_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_french_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_late_military_headgear
                accessory = male_headgear_european_military_cap_french_01
            }
        }
        weight = {   # Apparently this is locked behind SoI *and* VotP? And auto machine guns instead of bolt actions?
            base = 0 # Screw that lol
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_french_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_french_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_german_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = german_military_headgear
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_german_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_german_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_german_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = german_military_headgear
                accessory = male_headgear_european_military_10 # Pickelhaube only
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_german_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_german_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_russian_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = russian_military_headgear
                range = { 0 0.65 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                military_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_russian_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_has_russian_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_russian_military_soldier_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = russian_military_headgear
                accessory = male_headgear_russian_military_01
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_late_army_uniform_trigger = no
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_russian_influence_trigger = yes
                scope:pop ?= {
                    owner ?= {
                        NOT = { has_technology_researched = repeaters }
                    }
                }
            }
        }
    }
    
    WCR_russian_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = russian_military_headgear
                accessory = male_headgear_european_military_03_late_russian
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                agitator_character_trigger = no
                soldier_clothes_pop_trigger = no
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_army_clothes_trigger = yes
                WCR_army_has_russian_influence_trigger = yes
            }
            modifier = {
                add = 100
                monarchy_clothes_trigger = yes
                WCR_late_army_uniform_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_russian_influence_trigger = yes
                military_clothes_trigger = yes
            }
        }
    }
    
    WCR_korean_empire_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = korean_empire_military_headgear
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100 # Vanilla: 1200
                JKUP_is_active_trigger = no # JKUP compatibility/deconflict
                OR = {
                    AND = {
                        OR = {
                            has_game_rule = WCR_modded_KOR_westernization
                            has_game_rule = WCR_mixed_KOR_westernization
                        }
                        OR = {
                            scope:pop ?= {
                                exists = owner
                                owner  = {
                                    WCR_is_korea_trigger = yes
                                }
                            }
                            scope:character ?= {
                                exists = owner
                                owner  = {
                                    WCR_is_korea_trigger = yes
                                }
                            }
                        }
                        agitator_character_trigger = no
                        WCR_has_completed_westernization_trigger = yes
                        WCR_army_clothes_trigger = yes
                        WCR_late_army_uniform_trigger = no
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_KOR_westernization
                        scope:character ?= {
                            # culture = cu:korean
                            owner ?= {
                                WCR_is_korea_trigger = yes
                                has_variable = KOR_korean_empire_declared
                            }
                        }
                        OR = {
                            scope:character = {
                                has_role = general
                            }
                            AND = {
                                politician_clothes_trigger = yes
                                armed_forces_clothes_trigger = yes
                                # scope:character ?= {
                                    # NOT = { has_ideology = ideology:ideology_traditionalist }
                                # }
                            }
                        }
                        agitator_character_trigger = no
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_KOR_westernization
                        scope:pop ?= {
                            # culture = cu:korean
                            owner ?= {
                                WCR_is_korea_trigger = yes
                                has_variable = KOR_korean_empire_declared
                            }
                        }
                        OR = {
                            soldier_clothes_pop_trigger = yes
                            officers_clothes_pop_trigger = yes
                        }
                    }
                }
            }
        }
    }
    
    WCR_japanese_meiji_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = european_military_02_colors
                range = { 0 1 }
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100 # Vanilla: 1200
                md_japanese_uniform_pack_active_trigger = no # JUP compatibility/deconflict
                OR = {
                    AND = {
                        OR = {
                            has_game_rule = WCR_modded_JAP_westernization
                            has_game_rule = WCR_mixed_JAP_westernization
                        }
                        OR = {
                            scope:pop ?= {
                                exists = owner
                                owner  = {
                                    WCR_is_japan_trigger = yes
                                }
                            }
                            scope:character ?= {
                                exists = owner
                                owner  = {
                                    WCR_is_japan_trigger = yes
                                }
                            }
                        }
                        agitator_character_trigger = no
                        WCR_has_completed_westernization_trigger = yes
                        WCR_army_clothes_trigger = yes
                        WCR_late_army_uniform_trigger = no
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_JAP_westernization
                        scope:character ?= {
                            # culture = cu:japanese
                            owner ?= {
                                WCR_is_japan_trigger = yes
                                has_variable = meiji_restoration_complete
                            }
                        }
                        OR = {
                            scope:character = {
                                has_role = general
                            }
                            AND = {
                                politician_clothes_trigger = yes
                                armed_forces_clothes_trigger = yes
                                # scope:character ?= {
                                    # NOT = { has_ideology = ideology:ideology_traditionalist }
                                # }
                            }
                        }
                        agitator_character_trigger = no
                    }
                    AND = {
                        has_game_rule = WCR_vanilla_JAP_westernization
                        scope:pop ?= {
                            # culture = cu:japanese
                            owner ?= {
                                WCR_is_japan_trigger = yes
                                has_variable = meiji_restoration_complete
                            }
                        }
                        OR = {
                            soldier_clothes_pop_trigger = yes
                            officers_clothes_pop_trigger = yes
                        }
                    }
                }
            }
        }
    }
    
    WCR_arabic_military_fez = { # Excludes the fancy female headgear meant for high class pops
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_headgear
                template = arabic_fez_westernized
                accessory = male_headgear_arabic_common_01
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                OR = {
                    scope:character ?= {
                        owner ?= {
                            OR = {
                                WCR_st_is_country_tag = { TAG = TUR }
                                WCR_st_is_country_tag = { TAG = EGY }
                            }
                        }
                    }
                    scope:pop ?= {
                        owner ?= {
                            OR = {
                                WCR_st_is_country_tag = { TAG = TUR }
                                WCR_st_is_country_tag = { TAG = EGY }
                            }
                        }
                    }
                }
                OR = {
                    AND = {
                        OR = {
                            monarchy_clothes_trigger = yes
                            AND = {
                                ruler_clothes_trigger    = yes
                                military_clothes_trigger = yes
                            }
                        }
                        OR = { # Needed because this is used for both the royal attire & the commander attire
                            WCR_late_army_uniform_trigger = no
                            military_clothes_trigger = no
                        }
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_late_army_uniform_trigger = no
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_persian_ruler_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = arabic_naser_qajar
                accessory = male_headgear_arabic_naser_qajar_01
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_ruler_has_domestic_influence_trigger = yes
                WCR_has_completed_westernization_trigger = yes
                monarchy_clothes_trigger = yes
                scope:character ?= {
                    is_ruler = yes # Hat for ruler only
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = PER }
                    }
                    NOR = { # Exclusions
                        has_template = PER_reza_pahlavi
                        has_template = per_nasir_al_din_qajar_template
                    }
                }
                OR = { # Needed because this is used for both the royal attire & the commander attire
                    WCR_late_army_uniform_trigger = no
                    military_clothes_trigger = no
                }
            }
        }
    }
    
    WCR_persian_military_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = male_headgear_arabic_royal_01
                accessory = male_headgear_arabic_royal_01
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = no
                OR = {
                    scope:pop ?= {
                        owner ?= {
                            WCR_st_is_country_tag = { TAG = PER }
                        }
                    }
                    scope:character ?= {
                        owner ?= {
                            WCR_st_is_country_tag = { TAG = PER }
                        }
                    }
                }
                OR = {
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_persian_soldier_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = male_headgear_arabic_sattar_khan
                accessory = male_headgear_arabic_sattar_khan
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = yes
                scope:pop ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = PER }
                    }
                }
                OR = {
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_persian_commander_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = reza_shah_pahlavi_cap
                accessory = reza_shah_pahlavi_cap
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = yes
                scope:character ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = PER }
                    }
                }
                OR = {
                    AND = {
                        ruler_clothes_trigger = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_chinese_modern_ruler_headgear_qing = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template  = qing_new_army_headgear
                accessory = qing_guanmao
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                md_chinese_uniform_pack_active_trigger   = no # CUP compatibility/deconflict
                WCR_has_completed_westernization_trigger = yes
                WCR_ruler_has_domestic_influence_trigger = yes
                monarchy_clothes_trigger = yes
                scope:character ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = CHI }
                    }
                    is_female = no
                    WCR_is_scope_owner_qing_dynasty_trigger = yes
                }
            }
        }
    }
    
    # WCR_chinese_modern_ruler_headgear_han = {
        # dna_modifiers = {
            # accessory = {
                # mode = add
                # gene = headgear
                # template = no_headgear
                # range = { 0 1 }
            # }
            # accessory = {
                # mode = add
                # gene = WCR_china_headgear
                # template  = qing_new_army_headgear
                # accessory = xinjunmao_jiangjun
            # }
        # }
        
        # weight = {
            # base = 0
            # modifier = {
                # add = 100
                # WCR_has_completed_westernization_trigger = yes
                # WCR_ruler_has_domestic_influence_trigger = yes
                # monarchy_clothes_trigger = yes
                # scope:character ?= {
                    # exists = owner
                    # c:CHI ?= owner
                    # is_female = no
                    # WCR_is_scope_owner_qing_dynasty_trigger = no
                # }
            # }
        # }
    # }
    
    WCR_chinese_modern_general_headgear_qing = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template = qing_new_army_headgear
                range = { 0.5 1 }
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_late_army_uniform_trigger = no
                md_chinese_uniform_pack_active_trigger   = no # CUP compatibility/deconflict
                WCR_has_completed_westernization_trigger = yes
                scope:character ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = CHI }
                    }
                    WCR_is_scope_owner_qing_dynasty_trigger = yes
                }
                OR = {
                    AND = {
                        ruler_clothes_trigger    = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_chinese_modern_general_headgear_han = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template = qing_new_army_headgear
                range = { 0.5 0.74 }
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_late_army_uniform_trigger = no
                md_chinese_uniform_pack_active_trigger   = no # CUP compatibility/deconflict
                WCR_has_completed_westernization_trigger = yes
                scope:character ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = CHI }
                    }
                    WCR_is_scope_owner_qing_dynasty_trigger = no
                }
                OR = {
                    AND = {
                        ruler_clothes_trigger    = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_chinese_modern_admiral_headgear_qing = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template = qing_modern_navy_headgear
                range = { 0 1 }
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                md_chinese_uniform_pack_active_trigger   = no # CUP compatibility/deconflict
                WCR_has_completed_westernization_trigger = yes
                scope:character ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = CHI }
                    }
                    WCR_is_scope_owner_qing_dynasty_trigger = yes
                }
                WCR_navy_clothes_trigger = yes
                WCR_navy_has_domestic_influence_trigger = yes
            }
        }
    }
    
    WCR_chinese_modern_admiral_headgear_han = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template = qing_modern_navy_headgear
                range = { 0 0.66 }
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                md_chinese_uniform_pack_active_trigger   = no # CUP compatibility/deconflict
                WCR_has_completed_westernization_trigger = yes
                scope:character ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = CHI }
                    }
                    WCR_is_scope_owner_qing_dynasty_trigger = no
                }
                WCR_navy_clothes_trigger = yes
                WCR_navy_has_domestic_influence_trigger = yes
            }
        }
    }
    
    WCR_chinese_modern_officer_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template  = qing_new_army_headgear
                accessory = xinjunmao_junguan
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                md_chinese_uniform_pack_active_trigger   = no # CUP compatibility/deconflict
                WCR_has_completed_westernization_trigger = yes
                scope:pop ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = CHI }
                    }
                }
                soldier_clothes_pop_trigger = no
                OR = {
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_late_army_uniform_trigger = no
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    WCR_chinese_modern_soldier_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = no_headgear
                range = { 0 1 }
            }
            accessory = {
                mode = add
                gene = WCR_china_headgear
                template  = qing_new_army_headgear
                accessory = xinjunmao_shibing
            }
        }
        
        weight = {
            base = 0
            modifier = {
                add = 100
                md_chinese_uniform_pack_active_trigger   = no # CUP compatibility/deconflict
                WCR_has_completed_westernization_trigger = yes
                scope:pop ?= {
                    owner ?= {
                        WCR_st_is_country_tag = { TAG = CHI }
                    }
                }
                soldier_clothes_pop_trigger = yes
                OR = {
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_late_army_uniform_trigger = no
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_navy_clothes_trigger = yes
                        WCR_navy_has_domestic_influence_trigger = yes
                    }
                }
            }
        }
    }
    
    # Fake or semi-historical late era military uniforms
    WCR_generic_beige_cap_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = russian_military_headgear
                accessory = male_headgear_european_military_03_late_russian
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = yes
                OR = {
                    AND = {
                        ruler_clothes_trigger = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        soldier_clothes_pop_trigger = no
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                }
                
                OR = { # Hell yeah, DRY baybee (⌐■_■)
                    scope:pop ?= {
                        save_temporary_scope_as = person
                    }
                    scope:character ?= {
                        save_temporary_scope_as = person
                    }
                }
                scope:person ?= {
                    owner ?= {
                        OR = {
                            AND = {
                                WCR_is_korea_trigger = yes
                                JKUP_is_active_trigger = no # JKUP compatibility/deconflict
                                OR = {
                                    has_game_rule = WCR_modded_KOR_westernization
                                    has_game_rule = WCR_mixed_KOR_westernization
                                }
                            }
                            AND = {
                                WCR_is_japan_trigger = yes
                                md_japanese_uniform_pack_active_trigger = no # JUP compatibility/deconflict
                                OR = {
                                    has_game_rule = WCR_modded_JAP_westernization
                                    has_game_rule = WCR_mixed_JAP_westernization
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    
    WCR_generic_british_cap_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = late_military_cap
                accessory = male_headgear_european_late_military_04
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = yes
                OR = {
                    AND = {
                        ruler_clothes_trigger = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        soldier_clothes_pop_trigger = no
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                }
                
                OR = {
                    scope:pop ?= {
                        save_temporary_scope_as = person
                    }
                    scope:character ?= {
                        save_temporary_scope_as = person
                    }
                }
                scope:person ?= {
                    owner ?= {
                        OR = {
                            AND = {
                                WCR_is_japan_trigger = yes
                                md_japanese_uniform_pack_active_trigger = no # JUP compatibility/deconflict
                                OR = {
                                    has_game_rule = WCR_modded_JAP_westernization
                                    has_game_rule = WCR_mixed_JAP_westernization
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    
    WCR_generic_blue_cap_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = european_late_military_headgear
                accessory = male_headgear_european_military_cap_french_01
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = yes
                OR = {
                    AND = {
                        ruler_clothes_trigger = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        # soldier_clothes_pop_trigger = no # Give it to everyone
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                }
                
                OR = {
                    scope:pop ?= {
                        save_temporary_scope_as = person
                    }
                    scope:character ?= {
                        save_temporary_scope_as = person
                    }
                }
                scope:person ?= {
                    owner ?= {
                        OR = {
                            AND = {
                                md_chinese_uniform_pack_active_trigger = no # CUP compatibility/deconflict
                                WCR_st_is_country_tag = { TAG = CHI }
                            }
                        }
                    }
                }
            }
        }
    }
    
    WCR_generic_green_cap_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = reza_shah_pahlavi_cap
                accessory = reza_shah_pahlavi_cap
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = yes
                OR = {
                    AND = {
                        ruler_clothes_trigger = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                }
                
                # Male characters only (we're reusing the Reza Shah hat, which has Arabic headgear for the female
                scope:character ?= {
                    is_female = no
                    owner ?= {
                        OR = {
                            WCR_is_korea_trigger = yes
                        }
                    }
                }
            }
        }
    }
    
    WCR_arabic_military_late_headgear = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template  = male_headgear_arabic_sattar_khan
                accessory = male_headgear_arabic_sattar_khan
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
                WCR_has_completed_westernization_trigger = yes
                WCR_late_army_uniform_trigger = yes
                OR = {
                    AND = {
                        ruler_clothes_trigger = yes
                        military_clothes_trigger = yes
                        WCR_ruler_has_domestic_influence_trigger = yes
                    }
                    AND = {
                        WCR_army_clothes_trigger = yes
                        WCR_army_has_domestic_influence_trigger = yes
                    }
                }
                
                OR = {
                    scope:pop ?= {
                        save_temporary_scope_as = person
                    }
                    scope:character ?= {
                        save_temporary_scope_as = person
                    }
                }
                scope:person ?= {
                    owner ?= {
                        OR = {
                            WCR_st_is_country_tag = { TAG = TUR }
                            WCR_st_is_country_tag = { TAG = EGY }
                        }
                    }
                }
            }
        }
    }
}
